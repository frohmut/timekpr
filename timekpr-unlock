#!/bin/bash

# timekpr-unlock username
# Resets/unsets the old expiration date of the username

if [[ "$1" == "" ]]; then
	echo "Usage: timekpr-unlock username"
	exit
fi

#Default directory
TIMEKPRDIR=/var/lib/timekpr

# Get old expiration date
oldexpiration=$(cat $TIMEKPRDIR/$1.lock)
if [[ "$oldexpiration" == "" ]]; then
	oldexpdate=""
else
	oldexpdate=$(date -d "1970-01-01 $oldexpiration days" +%Y-%m-%d)
fi

#remove lock, reset old expiration date
[[ -e $TIMEKPRDIR/$1.lock ]] && rm -f $TIMEKPRDIR/$1.lock
usermod -e "$oldexpdate" $1
